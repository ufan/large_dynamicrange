\documentclass[preprint, times]{elsarticle}

%%%%%%%%%%%%%%   Preample  %%%%%%%%%%%%%%%%%%

%% The amssymb package provides various useful mathematical symbols
\usepackage{amssymb}
%% The amsthm package provides extended theorem environments
\usepackage{amsthm}
\usepackage{mathtools}

%% for celcius symbol
\usepackage{textcomp}

%% for units
\usepackage{siunitx}

%% The lineno packages adds line numbers. Start line numbering with
%% \begin{linenumbers},  end it with \end{linenumbers}. Or switch it on
%% for the whole article with \linenumbers.
\usepackage{lineno}
\modulolinenumbers[5]

\usepackage{hyperref}

%% package for type Greek letters without entering into math-mode
\usepackage{textgreek}

%% package for large picture in two-colume
\usepackage{dblfloatfix}
\usepackage{fixltx2e}
\usepackage{float}
\usepackage{booktabs}
\usepackage{tabulary}

\usepackage{comment}

%% only jpg pdf eps are allowed, tiff format are not allowed in latex
%% eps in principle can't be compiled by pdflatex, pdf not compiled by latex, but Kile can do some intermedate conversion to allow this happen.
\DeclareGraphicsExtensions{.pdf, .eps, .jpg}
%%opening
\journal{NIMA}

\begin{document}

%%%%%%%%%%%%%% Front Matter %%%%%%%%%%%%%%%%%%
\begin{frontmatter}

%\title{Design of a large dynamic range readout unit for the PSD detector of DAMPE}
\title{The large dynamic range readout design of the plastic scintillator detector of DAMPE}
%The readout design for the large dynamic range requirement of DAMPE-PSD

\author[imp,lzu,ucas]{Yong Zhou}
\author[imp]{Zhiyu Sun}

\author[imp]{Yuhong Yu\corref{corresponding_author}}
\cortext[corresponding_author]{Corresponding author}
\ead{yuyuhong@impcas.ac.cn}

\author[imp]{Yongjie Zhang}
\author[imp]{Fang Fang}
\author[imp]{Junling Chen}

\author[lzu]{Bitao Hu}

\address[imp]{Institute of Modern Physics, Chinese Academy of Sciences,  509 Nanchang Road,  Lanzhou,  730000,  P.R.China}
\address[lzu]{School of Nuclear Science and Technology,  Lanzhou University,  222 South Tianshui Road,  Lanzhou,  730000,  P.R.China}
\address[ucas]{Graduate University of the Chinese Academy of Sciences,  19A Yuquan Road,  Beijing,  100049,  P.R.China}
%%
\begin{abstract}

A large dynamic range is required by the Plastic Scintillator Detector (PSD) of DArk Matter Particle Explorer (DAMPE), and a double-dynode readout has been developed. To verify this design, a prototype detector module has been constructed and tested with cosmic rays and heavy ion beams.
The results match with the estimation and the readout unit could easily cover the required dynamic range.

\end{abstract}

%%
\begin{keyword}
PSD
\sep DAMPE
\sep large dynamic range
\sep double-dynode readout

%% PACS codes here,  in the form: \PACS code \sep codes

\end{keyword}

\end{frontmatter}

\linenumbers
%%%%%%%%%%%%%%%%  Introduction  %%%%%%%%%%%%%%%%%%%%%%%
\section{Introduction}
\label{sec:introduction}

DArk Matter Particle Explorer (DAMPE) is a satellite-borne particle
detector aiming for in-direct dark matter search, high-energy gamma
astronomy and primary cosmic ray studies~\cite{Chang_Jin_dampe}. It is
designed to cover a wide energy range from \SI{5}{GeV} to
\SI{10}{TeV} for electrons and photons and from \SI{10}{GeV} to
\SI{1}{PeV} for heavy ions, with unprecedented
resolution(\SI{1.5}{\percent} for \SI{100}{\giga\electronvolt} electrons).

The Plastic Scintillator Detector (PSD), located at the top of the satellite, is a key component of DAMPE. 
It consists of two layers of plastic scintillator bars which are orthogonal to each other, and covers an effective area of
$\SI{820}{mm}\times\SI{820}{mm}$. 
The bars are made of EJ-200~\cite{scintillator}, with the dimension of $\SI{884}{mm} \times \SI{28}{\milli\meter} \times \SI{10}{mm}$.
Each bar  is readout at both ends by the Hamamatsu R4443 photomultiplier tube (PMT) , which is a low noise PMT ruggedized for space usage~\cite{r4443}. 
The EJ-560~\cite{scintillator} optical pads are used as the  coupling material between the bar end and the PMT to assure the proper transmission of the scintillation light as well as to avoid the hard contact between them.

By measuring the deposited energy, PSD serves as an anti-coincidence detector for e/$\gamma$ discrimination as well as a charge detector for cosmic heavy ions up to Z=20.
As the deposited energy of the charged particle in PSD is approximately proportional to $Z^2$, this implies a wide range of output signal amplitudes and requires a large dynamic range design for the PSD readout unit.
On the other hand, the available weight and power on the satellite is limited and this imposes a constraint in the selection of the electronic components of the readout unit.

In this paper, the readout system of PSD with large dynamic range and  low power consumption is reported.
An estimation of the dynamic range needed by PSD is presented in Sec.~\ref{sec:requirement}.
The readout scheme is determined based on this estimation, and the detailed design process and the composition of the readout unit are described in Sec.~\ref{sec:design}.
Verification tests for the dynamic range have also been carried out on a prototype detector module using cosmic ray and relativistic heavy ion beam.
The test results are discussed in Sec.~\ref{sec:result}.
%The detailed description of the design is presented in Sec.\ref{sec:requirement} and Sec.\ref{sec:design}, and the test results are discussed in Sec.\ref{sec:result}.


%%%%%%%%%%%%%%%% Main Text Body %%%%%%%%%%%%%%%%%%%%%%%
\section{Dynamic range requirement}
\label{sec:requirement}

The dynamic range requirement for the PSD readout unit is affected by many different factors.
To make things more clear, we define the mean light yield produced by a singly charged minimum ionizing particle (e.g., electron with $\beta\gamma$ = 5) penetrating vertically through the center of the PSD bar as one MIP, and use it as the unit for the dynamic range estimation.

%The relationship between the response of the scintillator to a charged particle and its scintillation efficiency is one of the most important aspects, which will enlarge the dynamic range requirements. 
The light yield of the plastic scintillator in response to different charged particles forms the basis for the dynamic range estimation.
Due to the quenching effect, the scintillation efficiency of organic scintillator is not a constant, but a nonlinear function of the energy loss $dE/dx$, which can be described empirically by the Birks' law~\cite{birks_theory_2013}.
 However, for heavy ions in the relativistic region, the scintillation mechanism is much more complicated and the Birks' law fails to apply directly. 
 Several modified models ~\cite{chou_nature_1952,tarle_cosmic_1979,menchaca-rocha_response_1999,matsufuji_response_1999} have been proposed to extend the Birks' law, nevertheless large discrepancy exists among them when extrapolating to the high-Z nuclides.
Due to these theoretical difficulties, our estimation of the light yield is based on the relativistic heavy ion beam test result of AMS-02 TOF detector~\cite{bindi2005performance,bindi_calibration_2014}, which also uses EJ-200 with the same thickness as the detection material.
According to the parameters from \cite{bindi2005performance}, the light output of calcium (Z=20) is about 270 times larger than that of proton (Z=1).
As all singly charged minimum ionization particles have approximately the same energy loss in the PSD bar, they have approximately the same light output as well.
Thus, the mean light yield of the PSD bar in response to all the charged particle species covered by PSD ranges from \SIrange{1}{270}{MIPs}.

%The second factor we considered is the broad field view of DAMPE, which asks for a maximum incidence angle of \SI{60}{\degree}. It indicates that the traversing length and the energy deposit in the bar is double to the perpendicular incident particle, and this expands the maximum light yield to \SI{540}{MIPs}. 
The mean light yield is also related to the traversing length of the incident particle in the PSD bar.
DAMPE is designed to cover a broad field view, which demands the maximum incidence angle to be $\pm\SI{60}{\degree}$.
Thus, the maximum traversing length is twice that of the normal incidence case.
This in turn doubles the energy loss as well as the light yield and extends the maximum mean light yield to \SI{540}{MIPs}.

%Moreover, the statistical nature of the ionizing and scintillation process should be also taken into account. 
Both the process of energy loss in the plastic scintillator and the associated scintillation are intrinsically random, leading to the light yield fluctuation.
The light yield fluctuation follows the Gaussian distribution.
Assuming the standard deviation ($\sigma$) of the fluctuation is \SI{10}{\percent} and 5$\sigma$ is adopted for the full coverage, the upper limit of the light yield extends to \SI{675}{MIPs} and the lower limit reduces to \SI{0.75}{MIPs}.
%measurable energy deposition per scintillator bar up to 675 MIPs is required as a 5$\sigma$ width is accepted. And the lower limit of measurement must be smaller than \SI{0.75}{MIP} on the other hand.

%The third factor is the special shape of the scintillator bar since the light attenuation along the bar could not be negligible in the transmission process.
The scintillation photons produced at the hit position are transmitted to the bar end undergoing a series of reflection, absorption and refraction.
To improve the reflection efficiency, the PSD bars are surface polished and wrapped by the Tyvek paper~\cite{tyvek}. 
However, the length of the PSD bar is so long that the light attenuation during the transmission process can not be ignored, and this extends the dynamic range tremendously.
A preliminary test shows that the light attenuation ratio from the center to the end of the bar can be well controlled above \SI{50}{\percent}. 
Thus, the light intensity collected by the PMT at the bar end shall vary between \SI{0.375}{MIP} and \SI{1350}{MIPs}.

%Considering the noise from PMTs and the electronics and 
Finally, to ensure the clear separation of the smallest signal from the electronic noise as well as to leave some redundancy for the adjustment, the dynamic range requirement for the readout unit of PSD is determined to be \SI{0.1}{MIP}$\sim$\SI{1400}{MIPs}.

\section{Design of the readout unit}
\label{sec:design}

\subsection{Readout scheme}
\label{sec:scheme}

\begin{figure*}
\centering
 \includegraphics[width=140mm]{readout_scheme}
\caption{PSD readout scheme with two measurement ranges.}
\label{fig:readout_scheme}
\end{figure*}

An application specific integrated circuit VA160, developed by IDEAS Inc.~\cite{va160}, is adopted as the charge measurement circuit of PSD.
VA160 is a low power and radiation harden chip designed specifically for the DAMPE project, and is optimized for positive input charge  with a dynamic range from \SI{-3}{\pico\coulomb} to \SI{13}{\pico\coulomb}.
It has 32 input channels, and each channel has a full chain of charge sensitive pre-amplifier, CR-RC shaping amplifier and sample-hold circuit for independent charge measurement.

To cover the required dynamic range of about 4 orders of magnitude, it's found that a single VA160 channel is not sufficient. 
Thus, the readout scheme which uses a PMT with double dynode outputs and connects the output signals to separate VA160 channels has been proposed and adopted for the readout system of PSD. 
Two measurement ranges can be achieved in this way, with the high-gain dynode channel for small light output measurement and the low-gain dynode channel for large light output measurement. 
To reduce the crosstalk between th low-gain and high-gain channels, signals from the two dynodes are connected to different VA160 chips as shown in Fig.\ref{fig:readout_scheme}.

The front-end electronic (FEE) board based on VA160 has been developed and fully tested by the PSD group~\cite{fee}. 
The analog to digital conversion is performed by a 14-bit ADC. 
The test result~\cite{fee} shows that a linear range up to \SI{12}{\pico\coulomb} is guaranteed for each FEE channel and the input noise level ($\sigma$) of the whole PSD readout channel is expected to be smaller than \SI{6}{\femto\coulomb}. 
This implies that the response of \SI{0.1}{MIPs} shall be larger than \SI{30}{\femto\coulomb} as 5$\sigma$ separation is required, i.e. \SI{1}{MIP}$\geq$\SI{300}{\femto\coulomb}.
Thus the dynamic range from \SI{0.1}{MIPs} to \SI{40}{MIPs} can be covered by the high-gain dynode channel, and the remaining range shall be covered by the low-gain dynode channel.
This constrains the gain ratio between the two dynode stages to be $\geq$35.

\subsection{Selection of the dynode stages}
\label{sec:dynodes_selection}
To select the appropriate dynode stages for readout, a rough estimation of the mean number of photon electrons (PE) generated by one MIP in the center of the bar is carried out.

The mean energy deposit of the MIP particle in a \SI{10}{\milli\meter} plastic scintillator is about \SI{2.0}{\mega\electronvolt}~\cite{olive_review_2014}, and the scintillation efficiency of EJ-200 is \SI[per-mode=symbol]{e4}{photons\per\mega\electronvolt}~\cite{scintillator}.
The scintillation photons are emitted isotropically in all directions.
Thus, half of these photons points to one end of the bar and the other half points to the other end.
However, due to the refraction on the boundary, only \SI{22.5}{\percent} of them are within the total reflection angle and will undergo the transmission process to the end of the bar.
The number of photon electrons is then deduced as follows:
\begin{align}
 N_{PEs} &= \frac{1}{2} \times \SI[per-mode=symbol]{2}{\mega\electronvolt} \times \SI{e4}{\per\mega\electronvolt} \times 0.225
           \times \varepsilon_{1} \times \varepsilon_{2} \times \varepsilon_{3} \times \varepsilon_{4} \nonumber \\
         &\approx \SI{48}{PEs\per{MIP}}
\label{eq:pes}
\end{align}
where $\varepsilon_1$ ($\approx$0.5) is the light attenuation ratio from the center to the end of the bar,
$\varepsilon_2$ ($\approx$0.3) is the the geometry factor introduced by the effective coupling area between the PMT and the end surface of the scintillator bar,
$\varepsilon_3$ ($\approx$0.95) is the transmission coefficient of EJ-560 which is the coupling material between the PMT and the bar,
and $\varepsilon_4$ ($\approx$0.15) is the quantum efficiency of R4443.

R4443 is a 10-stage PMT. 
By using a standard voltage divider (i.e. equal voltage drop between dynodes), the gain of R4443 is $1\times10^6$ at the typical supply voltage, which is obviously too high for the VA160 chip. 
A simple calculation shows that the secondary emission ratio $\delta$ between adjacent dynodes is about 3.98 when the typical voltage supply is applied,  according to the following equation:
\begin{equation}
G=\delta^{n}
\label{eq:gain}
\end{equation}
where $G$ is the anode current amplification, and $n$ is the number of the dynode stages. 
To match the dynamic range of VA160, the output signal should be extracted from the intermediate dynode stage to reduce the gain factor of R4443. 
The integrated charge $Q_{dn}$ of the signal from the n-th dynode is given by
\begin{equation}
Q_{dn}=Q_{n}-Q_{n-1}
\label{eq:dycharge}
\end{equation}
where $Q_{n-1}$ is the collected charge of the n-th dynode which is also the emitted charge of the $(n-1)$-th dynode, and $Q_{n}$ is the emitted charge of the n-th dynode. 
In the uniform voltage distribution case, the secondary emission ratio $\delta$ has the same value for each dynode stage and the gain of the n-th dynode $G_{dn}$ can be calculated as follows:
\begin{equation}
G_{dn}=\delta^{n}(1-1/\delta)
\label{eq:dygain}
\end{equation}
Based on Eq.~\ref{eq:pes} and  Eq.~\ref{eq:dygain}, the 8th dynode (Dy8) and the 5th dynode (Dy5)of R4443 are selected to cover the lower and higher part of the dynamic range respectively.
Dy8 has a gain of $4.71\times10^4$ and has a positive charge output of \SI{362} {\femto\coulomb} for one MIP. 
It's a little larger than our design value of \SI{300} {\femto\coulomb}, but the difference can be eliminated easily by the fine adjustment of the PMT supply voltage. 
On the other hand, the relative gain between Dy8 and Dy5 is about 63, which also meets our design requirement.
%used to the larger signals measurements, as the maximum relative gain factor across three dynodes is \SI{63} from a numerical calculation. 
Combing Dy8 and Dy5, the readout unit of PSD achieves the required dynamic range of 4 orders of magnitude, and also provides a cross calibration between the two dynodes.

\subsection{Voltage divider circuit}
\label{sec:divider_design}

\begin{figure*}
\centering
 \includegraphics[width=130mm]{divider}
\caption{Circuit diagram of the voltage divider.}
\label{fig:divider}
\end{figure*}

A cathode grounding voltage divider circuit, which can extract current pulses from both Dy5 and Dy8, is designed as shown in Fig.\ref{fig:divider}.
The uniform voltage distribution ratio is adopted instead of the tapered one because the space charge effect is not an issue at the PSD light intensity level.

In this design, the parallel decoupling capacitors C1$\sim$C7 are added to keep the last few interstage voltage drops stable. Two serial-chained capacitors (C8/C9 and C11/C12) are used in each readout branch to provide robustness, in case that one of them breaks down and the other one can still protect the following circuits. 
The damp resistors R10/R11 and the bypass capacitors C10/C13 are added to better form the output pulse shape. 
To minimize the power consumption of PSD, the power of each PMT divider is designed to be less than 20 mW. 
Moreover, the coaxial cables are used to transmit the signals to the FEE board to reduce the potential electromagnetic interference.


\section{Verification tests}
\label{sec:result}
Based on the design described above, a prototype of the PSD detector module has been developed.
Tests with cosmic ray and high energy ion beam were carried out to verify the performance of the readout unit.
Before these tests, the related FEE channels were calibrated by the on-board charge calibration circuit~\cite{fee}.
The calibration parameters are listed in Table~\ref{tab:calibration}, and they will be used to convert ADC counts into charge in the analysis of the test results.

\begin{table}\footnotesize
	\centering
	\caption{Electronic calibration results. }
	\label{tab:calibration}
	\begin{tabulary}{80mm}{CCC}
		\toprule
		%   \multirow{2}{*}{}
		& $K_{Dy8} (\si{\per\femto\coulomb})$  & $K_{Dy5}$ (\si{\per\femto\coulomb}) \\
		\midrule
		Left  & 1.129 &  1.122\\
		Right  & 1.082 & 1.129\\
		\bottomrule
	\end{tabulary}
\end{table}

\subsection{Results from cosmic ray tests}
\label{sec:cosmicray}
Cosmic ray muons at the sea level are singly charged minimum ionization particles, so they are widely used to study the MIP response of detectors in the laboratory.
The layout of the test setup we used to study the MIP response of the prototype PSD detector module is shown in Fig.~\ref{fig:cosmic_test}.
Two small plastic scintillator detectors ($\SI{10}{mm} \times \SI{10}{mm} \times \SI{10}{mm}$), S1 and S2, are used to tag the cosmic rays of vertical incidence, and they are fixed in a movable support which can move along the bar direction.
In this way, the response difference at various positions of the detector module can be investigated.

\begin{figure}[h]
	\centering
	\includegraphics[width=130mm]{cosmic_test}
	\caption{The experimental setup for the cosmic ray test.}
	\label{fig:cosmic_test}
\end{figure}

\begin{table}\footnotesize
	\centering
	\caption{Summary of cosmic ray test results.}
	\label{tab:mip}
	\begin{tabulary}{85mm}{CCCCCCC}
		\toprule
		& $\sigma_{noise}$ & $\mu_{mpv}$ & $\sigma_{mpv}$ & $dy58$ & $\eta_{min}$ & $\eta_{max}$\\
		\cmidrule(r){2-4}\cmidrule(r){5-7}
		&\multicolumn{3}{c}{(unit: ADC counts)}&\multicolumn{3}{c}{(unit: 1)}\\
		\midrule
		Left  &  4.5 & 419.6 & 83.1 & 48.1 & 0.76 & 1.86 \\
		Right  & 5.8 & 395.8 & 65.6 & 44.6 & 0.74 & 1.94 \\
		\bottomrule
	\end{tabulary}
\end{table}

\begin{figure}[h]
	\centering
	\includegraphics[width=80mm]{mip}
	\caption{The MIPs response recorded by dynode 8 in the middle of the PSD scintillator bar. The noise spectrum of this readout channel are shown in the same figure.}
	\label{fig:mip}
\end{figure}

\begin{figure}[h]
	\centering
	\includegraphics[width=80mm]{attenuation}
	\caption{The relative light output measured by the end PMTs at different hit positions along the PSD scintillator bar.}
	\label{fig:attenuation}
\end{figure}

\begin{figure}[h]
	\centering
	\includegraphics[width=80mm]{dy58}
	\caption{The correlation spectrum between the signals of Dy5 and Dy8 of the right-side PMT. The red line is the linear function fit.}
	\label{fig:dy58}
\end{figure}

The tagging detectors were first moved to the middle position of the PSD bar to study the MIP response at the center of the detector module.
The signal of Dy5 was small in this test so that the data from the Dy8 channels were utilized for data analysis.
Fig.~\ref{fig:mip} shows the raw ADC spectrum of the Dy8 channel from the right-side PMT, with the MIP and the pedestal spectrum in the same figure.
It can be seen the MIP peak is clearly separated from the pedestal noise and the MIP spectrum follows the Landau distribution.
The most probable value (MPV, $\mu_{mpv}$) of the distribution and the resolution ($\sigma_{mpv}$) can be extracted by fitting the lower half of the MIP peak using the Gaussian distribution, as shown in Fig.~\ref{fig:mip}.
The fitting results from both sides are summarized in Table~\ref{tab:mip}, together with noise RMS ($\sigma_{noise}$) of the corresponding channels.
%As the MPV equals to \SI{1}{MIP} as defined in Sec.~\ref{sec:requirement}, the lower limit of the readout dynamic range can be calculated as $5\sigma_{noise}/\mu_{mpv}$, which gives \SI{0.073}{MIPs} and \SI{0.054}{MIPs} for the right-side and left-side respectively.
%By converting the ADC counts into charge and taking into account the fact that the effective linear range of the FEE channel is \SI{12}{\pico\coulomb}, the covering range of the Dy8 channel can also be obtained as $12000\cdot K_{Dy8}/\mu_{mpv}$, which gives \SI{32.8}{MIPs} and \SI{32.3}{MIPs} respectively.
As the MPV equals to \SI{1}{MIP} as defined in Sec.~\ref{sec:requirement}, the lower limit of the readout dynamic range can then be calculated as $5\sigma_{noise}/\mu_{mpv}$ and the dynamic range of the Dy8 channel can be calculated as $12000K_{Dy8}/\mu_{mpv}$, where $12000$ comes from the fact that the effective linear range of the FEE channel is \SI{12}{\pico\coulomb}.
Substituting actual values into the formulas, we get that the lower limits for the two sides are both smaller than \SI{0.1}{MIPs}, which is consistent with our design requirement. 
And the dynamic range of the Dy8 channel is \SI{32}{MIPs} and \SI{33}{MIPs} for the left and right side respectively.

%The value of the RMS noise is 5.8 ADC counts (\SI{5.4}{\femto\coulomb}), which implies the lower limit of the dynamic range for this readout unit is about \SI{0.08}{MIPs} as a 5$\sigma$ separation is adopted to distinguish signal to noise.

The MIP measurements were then carried out every \SI{10}{\centi\meter} along the bar and the MPV value at each position was extracted as described above.
The MPV variance along the bar is depicted in Fig.~\ref{fig:attenuation}, where the values are normalized to the middle position.
As the MPV is proportional to the mean light output, Fig.~\ref{fig:attenuation} represents the light attenuation effect of the PSD bar and the data points can be fitted using the following model~\cite{taiuti_measurement_1996}:
\begin{equation}
A(x)=C_0(e^{-x/\lambda} + \alpha e^{-(2L-x)/\lambda})
\end{equation}
where $L$ is the length of the bar, $\alpha$ is an empirical factor related to the fraction of photons reflected back from the far end of the bar and adding to the light intensity at the near end.
Based on the fitting results, the light output ratio between the near end and the center ($\eta_{max}$) and the ratio between the far end and the center ($\eta_{min}$) are calculated,  and listed in Table~\ref{tab:mip}.
$\eta_{max}$ and $\eta_{min}$ can be used to calculate the maximum and the minimum light output of the PSD bar.

The relative gain between Dy8 and Dy5 was also extracted from the cosmic ray test by merging the data from all tested positions.
Fig.~\ref{fig:dy58} shows the correlation between the ADC counts of Dy5 and Dy8 from the right-side PMT.
It can be seen that a good linearity has been achieved between the two dynode stages.
By fitting the data with a linear function, the relative gain between Dy8 and Dy5 ($dy58$) can be extracted, which is the slope of the fitting function as shown in Fig.~\ref{fig:dy58}.
The data from the left-side PMT is processed in the same way, and the $dy58$s from both sides are also listed in Table~\ref{tab:mip}.
The upper limit of the readout dynamic range can then be deduced as $12000K_{Dy5} \cdot dy58/\mu_{mpv}$, which gives \SI{1543}{MIPs} and \SI{1527}{MIPs} for the left-side and right-side respectively.
They are both larger than \SI{1400}{MIPs} and satisfy our design requirement.
%\begin{table*}\footnotesize
%    \centering
%    \caption{Summary of the measured parameters of both ends of the PSD detector module}
%    \label{tab:summary}
%\begin{tabulary}{190mm}{CCCCCCCCCC}
%    \toprule
%%   \multirow{2}{*}{}
%    &\multicolumn{2}{c}{Electronics(Dy8)}&\multicolumn{2}{c}{MIPs(ADC)}&\multicolumn{1}{c}{}&\multicolumn{2}{c}{Light attenuation ratio}&\multicolumn{2}{l}{$^{40}Ar$(ADC)} \\
%    \cmidrule(r){2-3}\cmidrule(r){4-5}\cmidrule(r){7-8}\cmidrule(r){9-10}
%    & Calibration(\si{\per\femto\coulomb}) & RMS noise(ADC) & MPV & $\sigma$ & Dy8/Dy5 & FarEnd/Middle & NearEnd/Middle & Mean & $\sigma$ \\
%    \midrule
%    Left  & 1.129 & 4.5 & 419.6 & 83.1 & 48.1 & 0.76 & 1.86 & 1918.6 & 86.8 \\
%    Right  & 1.082 & 5.8 & 395.8 & 65.6 & 44.6 & 0.74 & 1.94 & 1920.6 & 81.3 \\
%    \bottomrule
%\end{tabulary}
%\end{table*}


\subsection{Results from relativistic heavy ion beam test}
\label{sec:beam}
The prototype PSD detector module was also tested using a relativistic ion beam at the H8 beam line of CERN-SPS to verify its covering range.
The primary $^{40}{Ar}$ beam of \SI{40}{AGeV\per c} was extracted from SPS and impinging on the center of the plastic scintillator bar of the module, and the same supply voltages of the PMTs as in the cosmic ray test were applied for direct comparison.

\begin{table}\footnotesize
	\centering
	\caption{$^{40}{Ar}$ beam test results. (Unit: ADC counts)}
	\label{tab:ion}
	\begin{tabulary}{80mm}{CCCC}
		\toprule
		& $\sigma_{noise}$ & $\mu_{Ar}$ & $\sigma_{Ar}$\\
		\midrule
		Left  & 4.9 & 1918.6 & 86.8 \\
		Right & 6.3 & 1920.6 & 81.3 \\
		\bottomrule
	\end{tabulary}
\end{table}

The Dy8 channels were found to be saturated in this test and only the data from Dy5 channels could be used for analysis.
Fig.~\ref{fig:Ar} shows the raw ADC spectrum of the Dy5 channel from the right-side PMT (the left-side PMT has a similar result).
The long tail on the left of the primary $^{40}Ar$ peak corresponds to the light nuclei which are the products of $^{40}Ar$ interacting with materials in front of the PSD detector module.
Using the Gaussian distribution, the mean value ($\mu_{Ar}$) and the standard deviation ($\sigma_{Ar}$) of the primary peak could be obtained as shown in Fig.~\ref{fig:Ar}.
The fitting results from both sides are summarized in Table~\ref{tab:ion}, in which the noise RMS of the FEE channels are also listed.
It can calculated that the relative resolution of the PSD detector module for $^{40}Ar$ is about \SI{4.5}{\percent} and \SI{4.2}{\percent}.

\begin{figure}[h]
 	\centering
 	\includegraphics[width=80mm]{Ar}
 	\caption{The pulse height spectrum of $^{40}Ar$ recorded by Dy5 of right-side PMT. The red line is the Gaussian fit of the peak.}
 	\label{fig:Ar}
\end{figure}
 
Combining the results from the cosmic ray test (see Table~\ref{tab:mip}), the light yield of Ar in the bar can be calculated as ${\mu_{Ar}\cdot dy58} / {\mu_{mpv}}$, which gives \SI{219.9}{MIPs} and \SI{216.4}{MIPs} for the left-side and right-side respectively.
A linear extrapolation from Ar (Z=18) to Ca (Z=10) based on the $Z^2$ dependency (i.e. without considering the quenching effect) gives that the light yield of Ca shall be about \SI{271.5}{MIPs} and \SI{267.2}{MIPs} ,which are both consistent with our expected value of \SI{270}{MIPs} from the AMS02-TOF beam test (see Sec.~\ref{sec:requirement}). 
On the other hand, the light yield fluctuation of Ca in PSD bar can be reasonably assumed to be \SI{5}{\percent} based on the relative resolution for Ar.
Taking into account other effects such as the traverse length and the light attenuation described in Sec.\ref{sec:requirement}, the largest signal of Ca in Dy5 is estimated to be \SI{1166.3}{MIPs} and \SI{1136.3}{MIPs}.
These values are well within the upper limit of the readout dynamic ranges which have been obtained in the cosmic ray test, and this verifies the PSD large dynamic readout design.


\section{Conclusion}
\label{sec:conclusion}
A large dynamic range readout unit with low power consumption has been successfully designed for the PSD detector of DAMPE.
Tests on a prototype detector module using cosmic ray and relativistic ion beam show that the readout unit could easily cover the dynamic range from 0.1 MIPs to 1400 MIPs, which is needed by PSD for measuring particles from electron to heavy ions with $Z\leq 20$ simultaneously 
However, an adjustment of the PMT supplying voltage is required to obtain the optimal performance and make full use of the measurement range. 
Due to the large individual difference of PMTs, it is also suggested that a detailed test of the readout PMTs be performed to reject tubes with extreme characteristics before the massive production and installation.

%%%%%%%%%%%%%%%% Acknowledgment %%%%%%%%%%%%%%%%%%%%%%%
\section*{Acknowledgment}
\label{sec:acknowledgement}

This work was supported by the Strategic Priority Research Program on Space Science of the Chinese Academy of Science,
Grant No. XDA04040202- 3.
The authors wish to thank all the people from DAMPE collaboration who helped make this work possible.

%%%%%%%%%%%%%%%%   Bibliography  %%%%%%%%%%%%%%%%%%%%%%%
%% bibliography style
\section*{References}
\label{sec:reference}
\bibliographystyle{elsarticle-num}

%% From BibTex file
\bibliography{mybib}

\end{document}

\endinput
